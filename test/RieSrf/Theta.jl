@testset "Theta functions" begin

  CC = AcbField(100)
  C = AcbField(70)
  
  z = Vector([CC(0.586880900643857469439302353523, 0.307726890045301234767128710989)])
  tau = matrix(CC, 1, 1, [CC(0.752230752961815185139240561368, 0.334439320499190242957291012839)])
  output1 = theta(z, tau)  
  output2 = theta(z, tau, dz=[[1]])
  output3 = theta(z, tau, dz=[[1], [1]])
  output4 = theta(z, tau, char=[[1],[0]])
  output5 = theta(z, tau, char=[[1],[1]])
  output6 = theta(z, tau, char=[[1],[0]], dz=[[1]])
  output7 = theta(z, tau, char=[[1],[1]], dz=[[1]])
  @test contains(C("1.2735454862976118381834628326", "-1.7499799155346868510084243863"), output1)
  @test contains(C("-7.147954727319352383742148041", "1.309902842326035536831023484"), output2)
  @test contains(C("36.15665899484055494348379750", "0.91811518062465044826726314"), output3)
  @test contains(C("2.208794040951156299135845162", "-2.2178050458891942113407881115"), output4)
  @test contains(C("-1.870097223948954648454752474", "0.6834338907132075113820426945"), output5)
  @test contains(C("-11.876271146170913141455757367", "-20.454949863557125176066279902"), output6)
  @test contains(C("12.338718541674397610651288656", "3.806478649152216412582513725"), output7)
  
  z = Vector([CC(0.235246811493023553454353345120, 0.572242771272930045301234767128), CC(-0.2289407543890171056282373432834, 0.872126561883344175932710989567)])
  tau = matrix(CC, 2, 2, [CC(0.641557439818943425018213065948, 0.419208800061681914437075404828),  CC(0.248736856316905782911355920355, - 0.0839928755399522307529618151853), CC(0.248736856316905782911355920355, - 0.0839928755399522307529618151853), CC(0.630928871825992496421837503228, 0.387733313924056075955767963258)])  
  
  output1 = theta(z, tau)  
  output2 = theta(z, tau, dz=[[1,0], [1,0]])
  output3 = theta(z, tau, dz=[[1,0], [0,1]])
  output4 = theta(z, tau, char=[[1,0],[1,1]])
  output5 = theta(z, tau, char=[[1,0],[0,1]])
  output6 = theta(z, tau, char=[[1,0],[1,1]], dz=[[1,0]])
  output7 = theta(z, tau, char=[[1,0],[0,1]], dz=[[0,1]])
  output8 = theta(z, tau, char=[[1,0],[0,1]], dtau=[[1,2]])
  @test contains(C("-6414.2064968642908498635", "-24417.8523277863464369123"), output1)
  @test contains(C("-1668224.86272009855384615901", "6074943.94481847759681673888"), output2)
  @test contains(C("-3100103.27895648432359532338", "8340455.02348805089212943305"), output3)
  @test contains(C("61654.9646823366981075785096", "-2139.18413662234871529743051"), output4)
  @test contains(C("-29697.8946209811999406500389", "1225.20378466161650738880027"), output5)
  @test contains(C("74034.102366158331793944750", "-795407.873823199528091512746"), output6)
  @test contains(C("82807.769225853166251157454", "581651.150501197244009231446"), output7)
  @test contains(C("-522425.568456835631376541542", "-1133273.131766238811203630453"), output8)
  
  z = Vector([CC(0.042352468114930235534543533451, 0.0572242771272930045301234767128), CC(0.122228907543890171056282373432834, 0.03872126334417593271098956712), CC(0.0481149302355345435334514826, 0.300453012347671285722427712729), CC(0.017105628237343283412222890754389, 0.4175932710989567123872126334)])

  tau = matrix(CC, 4, 4, [CC(0.552341944696119256511334466854, 0.530998008294603129797334675017),
  CC(-0.0449865284037281911302609648074, - 0.135630532248800092927677159296),
  CC(-0.0252755383760183323234843681809, - 0.118455205728276244417448600082),
  CC(0.0634721976637794003696335015948, - 0.117581708079994618893520231890),
  CC(-0.0449865284037281911302609648074, - 0.135630532248800092927677159296), 
  CC(0.586766430662900402728171214975, 0.389574696332480151881401423470), 
  CC(0.362682430925820482564136182891, - 0.0509114847541543172627733114847), 
  CC(0.230898842902483213761247092974, 0.0140354141674622712082520518484),
  CC(-0.0252755383760183323234843681809, - 0.118455205728276244417448600082), 
  CC(0.362682430925820482564136182891, - 0.0509114847541543172627733114847), 
  CC(0.620966134290863650606641032024,  0.266397982973633952908142975738), 
  CC(0.283638657681317736336988715106,  0.0489629552168053384591403256953),
  CC(0.0634721976637794003696335015948, - 0.117581708079994618893520231890), 
  CC(0.230898842902483213761247092974,  0.0140354141674622712082520518484), 
  CC(0.283638657681317736336988715106,  0.0489629552168053384591403256953), 
  CC(0.622365324311733132505006053322,  0.235796918228088156310401572910)])

  output1 = theta(z, tau)  
  output2 = theta(z, tau, dz=[[1,0,0,0], [1,0,0,0]])
  output3 = theta(z, tau, dz=[[0,1,0,0], [1,1,0,1]])
  output4 = theta(z, tau, char=[[1,0,0,0],[1,1,0,0]])
  output5 = theta(z, tau, char=[[1,0,0,0],[0,1,0,0]])
  output6 = theta(z, tau, char=[[1,0,0,0],[1,1,0,1]], dz=[[1,0,0,0]])
  output7 = theta(z, tau, char=[[1,0,0,0],[0,0,0,1]], dz=[[0,0,0,1]])
  output8 = theta(z, tau, char=[[1,0,1,0],[0,1,0,0]], dtau=[[3,2]])
  
  @test contains(C("24.95215512418069841669301", "132.47893351452183719169949"), output1)
  @test contains(C("-739.904546804840881135274", "-7199.839961325725755796296"), output2)
  @test contains(C("-18921.05224449491822667245", "544226.5280893633654476051"), output3)
  @test contains(C("-31.70089210570414937245688", "13.40555476715875838682336"), output4)
  @test contains(C("37.66990539852335870660100", "91.44179049397039350738742"), output5)
  @test contains(C("1152.3536799418238771740114", "-162.9661849031444286335942"), output6)
  @test contains(C("1168.234310401324690069037", "336.7636135978282273233196"), output7)
  @test contains(C("-61.78781768220718436001250", "115.8006853988874093607426"), output8)

  M, N = siegel_reduction(tau)
  C = AcbField(40)
  Mtest = matrix(C, 4,4, [C(0.007160942549222109748695, 0.999974360122201762114905), C(-0.459895672781324460467119 , 0.1477701136029038361429994), C(0.262152902603939173771323, -0.264036934353328822611527), C(0.1444730383038258705064533, -0.460942054406476900029191), C(-0.459895672781324460467119, 0.1477701136029038361429994), C(0.0343866683047143527088653, 1.0318748251289757225078932), C(-0.2446824819853176909579486, -0.3682436108593916745902766),   C(-0.3833299818413989356263086, -0.2176729734869315639914278), C(0.262152902603939173771323, -0.264036934353328822611527),   C(-0.2446824819853176909579486, -0.3682436108593916745902766),      C(0.4307801764768130057169985, 1.156221170046256978928040),      C(-0.404262235284686989557198, 0.450934690223819219613839), C(0.144473038303825870506453, -0.460942054406476900029191),   C(-0.3833299818413989356263086, -0.2176729734869315639914278), C(-0.404262235284686989557198 , 0.450934690223819219613839),      C(-0.1689426531982152234692907, 1.22251128407073538963863)])

  for i in (1:4)
    for j in (1:4)
      @test contains(Mtest[i,j], M[i,j])
    end
  end

end

 #z = [0.235246811493023553454353345120 + 0.572242771272930045301234767128im; -0.2289407543890171056282373432834 + 0.872126561883344175932710989567]


#=
 z = [0.042352468114930235534543533451 + 0.0572242771272930045301234767128im; 0.122228907543890171056282373432834 + 0.03872126334417593271098956712im; 0.0481149302355345435334514826 + 0.300453012347671285722427712729im; 0.017105628237343283412222890754389 + 0.4175932710989567123872126334im]


tau = [0.552341944696119256511334466854 + 0.530998008294603129797334675017im -0.0449865284037281911302609648074 - 0.135630532248800092927677159296im -0.0252755383760183323234843681809 - 0.118455205728276244417448600082im 0.0634721976637794003696335015948 - 0.117581708079994618893520231890im; -0.0449865284037281911302609648074 - 0.135630532248800092927677159296im 0.586766430662900402728171214975+0.389574696332480151881401423470im 0.362682430925820482564136182891 - 0.0509114847541543172627733114847im 0.230898842902483213761247092974 + 0.0140354141674622712082520518484im; -0.0252755383760183323234843681809-0.118455205728276244417448600082im  0.362682430925820482564136182891-0.0509114847541543172627733114847im 0.620966134290863650606641032024+0.266397982973633952908142975738im  0.283638657681317736336988715106+0.0489629552168053384591403256953im;
       0.0634721976637794003696335015948-0.117581708079994618893520231890im  0.230898842902483213761247092974+0.0140354141674622712082520518484im 0.283638657681317736336988715106+0.0489629552168053384591403256953im  0.622365324311733132505006053322+0.235796918228088156310401572910im]

=#

